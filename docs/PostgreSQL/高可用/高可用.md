# 高可用

## 方案比较

1. `共享磁盘故障转移`
   共享磁盘故障转移通过只有一个数据库副本来避免同步开销。它使用由多个服务器共享的单个磁盘阵列。如果主数据库服务器发生故障，备用服务器能够挂载并启动数据库，就好像它正在从数据库崩溃中恢复一样。这允许快速故障转移而不会丢失数据。共享硬件功能在网络存储设备中很常见。使用网络文件系统也是可能的，但必须注意文件系统具有完整的 POSIX 行为。此方法的一个重要限制是，如果共享磁盘阵列出现故障或损坏，主服务器和备用服务器都无法正常工作。另一个问题是，在主服务器运行时，备用服务器不应该访问共享存储。
2. `文件系统（块设备）复制`
   共享硬件功能的修改版本是文件系统复制，其中对文件系统的所有更改都被镜像到驻留在另一台计算机上的文件系统。唯一的限制是镜像必须以确保备用服务器具有一致的文件系统副本的方式完成——具体而言，对备用服务器的写入必须按照与主服务器相同的顺序进行。 DRBD 是适用于 Linux 的流行文件系统复制解决方案。
3. `预写式日志传送`
   暖和热备用服务器可以通过读取预写日志 (WAL) 记录流来保持最新状态。如果主服务器出现故障，备用数据库几乎包含了主服务器的所有数据，并且可以快速成为新的主数据库服务器。这可以是同步的或异步的，并且只能对整个数据库服务器进行。
4. `逻辑复制`
   逻辑复制允许数据库服务器将数据修改流发送到另一台服务器。 PostgreSQL 逻辑复制从 WAL 构造一个逻辑数据修改流。逻辑复制允许在每个表的基础上复制数据更改。此外，发布自己更改的服务器也可以订阅来自另一台服务器的更改，从而允许数据在多个方向流动。
5. `基于触发器的主备复制`
   基于触发器的复制设置通常将数据修改查询集中到指定的主服务器。在每个表的基础上运行，主服务器（通常）将数据更改异步发送到备用服务器。备用服务器可以在主服务器运行时回答查询，并且可能允许一些本地数据更改或写入活动。这种形式的复制通常用于卸载大型分析或数据仓库查询。
6. `基于 SQL 的复制中间件`
   使用基于 SQL 的复制中间件，程序会拦截每个 SQL 查询并将其发送到一个或所有服务器。每个服务器独立运行。读写查询必须发送到所有服务器，以便每个服务器都能接收到任何更改。但是只读查询只能发送到一台服务器，从而允许在它们之间分配读取工作负载。
7. `异步多主机复制`
   对于不定期连接或通信链接缓慢的服务器，如笔记本电脑或远程服务器，保持服务器之间的数据一致是一个挑战。使用异步多主机复制，每个服务器独立工作，并定期与其他服务器通信以识别冲突事务。冲突可以由用户或冲突解决规则来解决。 Bucardo 就是这种复制的一个例子。
8. `同步多主机复制`
   在同步多主机复制中，每个服务器都可以接受写入请求，并且在每个事务提交之前将修改的数据从原始服务器传输到其他每个服务器。繁重的写入活动会导致过多的锁定和提交延迟，从而导致性能下降。读取请求可以发送到任何服务器。一些实现使用共享磁盘来减少通信开销。同步多主机复制最适合大多数读取工作负载，尽管它的最大优点是任何服务器都可以接受写入请求 - 无需在主服务器和备用服务器之间划分工作负载，并且由于数据更改是从一台服务器发送到另一台服务器，因此像随机（）这样的非确定性函数没有问题。